{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<style>
    /* Dashboard Styles */
    .dashboard-container {
        padding: 20px;
        background: #f5f5f5;
        min-height: 100vh;
    }
    
    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .stat-card.green {
        background: linear-gradient(135deg, #c3e6cb 0%, #d4edda 100%);
        border-left: 4px solid #28a745;
    }
    
    .stat-card.yellow {
        background: linear-gradient(135deg, #fff3cd 0%, #fff8dc 100%);
        border-left: 4px solid #ffc107;
    }
    
    .stat-card.blue {
        background: linear-gradient(135deg, #cce5ff 0%, #d9e8fb 100%);
        border-left: 4px solid #007bff;
    }
    
    .stat-card.gray {
        background: linear-gradient(135deg, #e2e3e5 0%, #f0f0f0 100%);
        border-left: 4px solid #6c757d;
    }
    
    .stat-info h3 {
        margin: 0;
        font-size: 32px;
        font-weight: bold;
        color: #333;
    }
    
    .stat-info p {
        margin: 5px 0 0 0;
        color: #666;
        font-size: 14px;
    }
    
    .stat-icon {
        font-size: 48px;
        opacity: 0.7;
    }
    
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .dashboard-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .dashboard-card h2 {
        margin-top: 0;
        color: #17a2b8;
        border-bottom: 2px solid #17a2b8;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    .top-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .top-list li {
        padding: 12px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .top-list .rating {
        font-weight: bold;
        padding: 5px 12px;
        border-radius: 20px;
        color: white;
        font-size: 14px;
    }
    
    .rating.excellent {
        background: #28a745;
    }
    
    .rating.good {
        background: #17a2b8;
    }
    
    .rating.average {
        background: #ffc107;
        color: #333;
    }
    
    .rating.poor {
        background: #dc3545;
    }
    
    .activity-list {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .activity-list li {
        padding: 10px;
        border-bottom: 1px solid #eee;
        font-size: 13px;
    }
    
    .activity-list li:last-child {
        border-bottom: none;
    }
    
    .activity-time {
        color: #999;
        font-size: 11px;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .action-btn {
        display: block;
        padding: 15px;
        background: #17a2b8;
        color: white;
        text-align: center;
        border-radius: 8px;
        text-decoration: none;
        transition: background 0.3s;
    }
    
    .action-btn:hover {
        background: #138496;
        color: white;
    }
    
    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Statistics Cards -->
    <div class="stats-row">
        <div class="stat-card green">
            <div class="stat-info">
                <h3>{{ total_surveys }}</h3>
                <p>{% trans "Total Surveys" %}</p>
            </div>
            <div class="stat-icon">üìä</div>
        </div>
        
        <div class="stat-card yellow">
            <div class="stat-info">
                <h3>{{ total_groups }}</h3>
                <p>{% trans "Academic Groups" %}</p>
            </div>
            <div class="stat-icon">üéì</div>
        </div>
        
        <div class="stat-card blue">
            <div class="stat-info">
                <h3>{{ total_professors }}</h3>
                <p>{% trans "Professors" %}</p>
            </div>
            <div class="stat-icon">üë®‚Äçüè´</div>
        </div>
        
        <div class="stat-card gray">
            <div class="stat-info">
                <h3>{{ recent_surveys }}</h3>
                <p>{% trans "Surveys (Last 7 Days)" %}</p>
            </div>
            <div class="stat-icon">üìà</div>
        </div>
    </div>
    
    <!-- Main Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Top Rated Professors -->
        <div class="dashboard-card">
            <h2>üåü {% trans "Top Rated Professors" %}</h2>
            {% if top_professors %}
                <ul class="top-list">
                    {% for item in top_professors %}
                        <li>
                            <div>
                                <strong>{{ item.professor.full_name }}</strong>
                                <br>
                                <small style="color: #666;">{{ item.professor.school }} ‚Ä¢ {{ item.count }} {% trans "surveys" %}</small>
                            </div>
                            <span class="rating {% if item.rating <= 2 %}excellent{% elif item.rating <= 3 %}good{% elif item.rating <= 4 %}average{% else %}poor{% endif %}">
                                {{ item.rating }}
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p style="color: #999;">{% trans "No survey data available yet." %}</p>
            {% endif %}
        </div>
        
        <!-- Recent Activity -->
        <div class="dashboard-card">
            <h2>‚ö° {% trans "Recent Activity" %}</h2>
            {% if recent_activity %}
                <ul class="activity-list">
                    {% for survey in recent_activity %}
                        <li>
                            <strong>{{ survey.group.group_name }}</strong> evaluated 
                            <strong>{{ survey.professor.full_name }}</strong>
                            <br>
                            <span class="activity-time">{{ survey.created_at|timesince }} {% trans "ago" %}</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p style="color: #999;">{% trans "No recent activity." %}</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Groups with High Participation -->
    <div class="dashboard-card">
        <h2>üìà {% trans "Groups with Highest Participation" %}</h2>
        {% if top_groups %}
            <ul class="top-list">
                {% for group in top_groups %}
                    <li>
                        <div>
                            <strong>{{ group.group_name }}</strong> - {{ group.department }}
                            <br>
                            <small style="color: #666;">{{ group.participated_students }} / {{ group.total_students }} {% trans "students participated" %}</small>
                        </div>
                        <span class="rating good">
                            {% if group.total_students > 0 %}
                                {% widthratio group.participated_students group.total_students 100 %}%
                            {% else %}
                                0%
                            {% endif %}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="color: #999;">{% trans "No groups with participation data yet." %}</p>
        {% endif %}
    </div>
    
    <!-- Quick Actions -->
    <div class="dashboard-card">
        <h2>üöÄ {% trans "Quick Actions" %}</h2>
        <div class="quick-actions">
            <a href="{% url 'admin:evaluations_group_add' %}" class="action-btn">
                ‚ûï {% trans "Add Group" %}
            </a>
            <a href="{% url 'admin:evaluations_professor_add' %}" class="action-btn">
                ‚ûï {% trans "Add Professor" %}
            </a>
            <a href="{% url 'admin:evaluations_survey_changelist' %}" class="action-btn">
                üìã {% trans "View All Surveys" %}
            </a>
            <a href="{% url 'admin:evaluations_groupprofessor_add' %}" class="action-btn">
                üîó {% trans "Assign Professor" %}
            </a>
        </div>
    </div>
</div>
{% endblock %}
