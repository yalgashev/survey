{% extends 'admin_custom/base.html' %}
{% load i18n %}

{% block title %}Professors Rating{% endblock %}

{% block content %}
<div class="content-header">
    <h1><i class="fas fa-star"></i> Professors Rating</h1>
    <p class="text-muted">Detailed performance ratings for all professors</p>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th style="min-width: 200px;">Professor Name</th>
                        {% for question in questions %}
                        <th class="text-center" style="min-width: 60px;">Q{{ question.order }}</th>
                        {% endfor %}
                        <th class="text-center bg-primary text-white" style="min-width: 100px;">Average Score</th>
                        {% if text_question %}
                        <th style="min-width: 300px;">Comments (Q{{ text_question.order }})</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for prof_data in professors_data %}
                    <tr>
                        <td><strong>{{ forloop.counter }}. {{ prof_data.professor.full_name }}</strong><br>
                            <small class="text-muted">{{ prof_data.professor.school }}</small>
                        </td>
                        {% for avg in prof_data.question_averages %}
                        <td class="text-center">
                            {% if avg > 0 %}
                                <span class="badge 
                                    {% if avg <= 2 %}bg-success
                                    {% elif avg <= 3 %}bg-warning
                                    {% else %}bg-danger
                                    {% endif %}">
                                    {{ avg }}
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        {% endfor %}
                        <td class="text-center">
                            <strong class="badge 
                                {% if prof_data.overall_average <= 2 %}bg-success
                                {% elif prof_data.overall_average <= 3 %}bg-warning
                                {% else %}bg-danger
                                {% endif %}" style="font-size: 1.1em;">
                                {{ prof_data.overall_average }}
                            </strong>
                        </td>
                        {% if text_question %}
                        <td>
                            {% if prof_data.comments %}
                                <div class="comments-section">
                                    {% for comment in prof_data.comments %}
                                    <div class="comment-item mb-2 p-2 bg-light rounded">
                                        <i class="fas fa-comment text-muted"></i> {{ comment|safe }}
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <span class="text-muted">No comments</span>
                            {% endif %}
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{{ questions.count|add:3 }}" class="text-center text-muted">
                            No rating data available
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card mt-3">
    <div class="card-header">
        <h5><i class="fas fa-info-circle"></i> Rating Scale Legend</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6>Numerical Scale:</h6>
                <ul>
                    <li><strong>1</strong> - Strongly Agree (Best)</li>
                    <li><strong>2</strong> - Agree</li>
                    <li><strong>3</strong> - Neither Agree nor Disagree</li>
                    <li><strong>4</strong> - Disagree</li>
                    <li><strong>5</strong> - Strongly Disagree (Worst)</li>
                    <li><strong>6</strong> - Not Applicable (Excluded from averages)</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>Color Coding:</h6>
                <ul>
                    <li><span class="badge bg-success">Green</span> - Excellent (â‰¤ 2.0)</li>
                    <li><span class="badge bg-warning">Yellow</span> - Average (2.1 - 3.0)</li>
                    <li><span class="badge bg-danger">Red</span> - Needs Improvement (> 3.0)</li>
                </ul>
                <p class="mt-2"><strong>Note:</strong> Lower scores are better. The list is sorted by average score in ascending order.</p>
            </div>
        </div>
    </div>
</div>

<style>
    .comment-item {
        font-size: 0.9em;
        border-left: 3px solid #007bff;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif, 'Microsoft YaHei', 'SimHei', Arial;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .comments-section {
        max-height: 300px;
        overflow-y: auto;
    }
</style>
{% endblock %}
