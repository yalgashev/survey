{% extends "admin_custom/base.html" %}
{% load i18n %}

{% block page_title %}Surveys{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-poll"></i> All Surveys</h2>
</div>

<div class="card-custom">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Group</th>
                        <th>Professor</th>
                        <th>Average Rating</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for survey in surveys %}
                    <tr>
                        <td>{{ survey.id }}</td>
                        <td>{{ survey.group.group_name }}</td>
                        <td>{{ survey.professor.full_name }}</td>
                        <td>
                            {% with avg=survey.get_average_rating %}
                                {% if avg > 0 %}
                                    <span class="badge-rating {% if avg <= 2 %}badge-excellent{% elif avg <= 3 %}badge-good{% elif avg <= 4 %}badge-average{% else %}badge-poor{% endif %}">
                                        {{ avg|floatformat:2 }}
                                    </span>
                                {% else %}
                                    N/A
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td>{{ survey.created_at|date:"Y-m-d H:i" }}</td>
                        <td>
                            <a href="{% url 'admin_survey_detail' survey.id %}" class="btn btn-sm btn-info">
                                <i class="fas fa-eye"></i> View
                            </a>
                            <a href="{% url 'admin_survey_delete' survey.id %}" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">No surveys found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
